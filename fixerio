#!/bin/bash

source fixerio_funcs.sh

# style guide: https://google.github.io/styleguide/shell.xml

# fixerio latest|historical

usage() {
  echo "Usage: $0 [-a latest|historical] [-b currency] [-s symbols] [-f prettify-colorful|prettify|no]" 1>&2
  exit 1
}

base="EUR"
symbols=""
color="no"
while getopts "a:b:s:f:" o; do
    case "${o}" in
        a)
          action=${OPTARG}
          [[ "$action" = "latest" || "$action" = "historical" ]] || usage
          ;;
        b)
          base=${OPTARG}
          ;;
        s)
          symbols=${OPTARG}
          ;;
        f)
          color=${OPTARG}
          [[ "$color" = "prettify-colorful" || "$color" = "prettify" || "$color" = "no" ]] || usage
          ;;
        *)
          usage
          ;;
    esac
done
shift $((OPTIND-1))


json=$(latest "$base" "$symbols")

if [[ "$color" = "prettify-colorful" ]] ; then
  echo $json | jq .
elif [[ "$color" = "prettify" ]] ; then
  echo $json | jq -M .
else
  echo $json
fi
